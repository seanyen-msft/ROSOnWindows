<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Continuous Delivery - ROS on Windows</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous Delivery";
    var mkdocs_page_input_path = "GettingStarted\\GithubSetupCD.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ROS on Windows</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../WhatsNew.html">What's New</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/buildfarm.html">Build Status</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Setup.html">ROS 1</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="SetupRos2.html">ROS 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="NewToROS.html">For new ROS Users</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 1</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="http://wiki.ros.org/ROS/Tutorials">Tutorials at ROS Wiki ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/moveit_tutorials.html">MoveIt</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/UR3.html">Universal Robot UR3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Turtlebot/Turtlebot3.html">TurtleBot 3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/sick_s300/getting_started.html">SICK S300</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/ethercat/soem.html">Simple Open EtherCAT Master</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/peak/peak.html">PEAK-System&reg; PCAN&reg;-Basic</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 2</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/nav2.html">Navigation 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Github Actions</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="GithubSetupCD.html">Continuous Delivery</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#sign-up-to-publish-packages">Sign up to Publish packages</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#packaging-collateral">Packaging collateral</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#crafting-a-mypackagenuspec-file">Crafting a MyPackage.nuspec file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-install-scripts">Adding install scripts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-the-build-script">Adding the build script</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#testing-the-package">Testing the package</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#package">Package</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#manually-publish-a-chocolatey-package">Manually Publish a chocolatey package</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Linux.html">Continuous Simulation (Linux)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Windows_Nav2.html">Continuous Simulation for Navigation2 System Tests</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Azure Pipelines</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCD.html">Continuous Delivery</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCS_Linux.html">Continuous Simulation (Linux)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/system_tests.html">Continuous Simulation for Navigation2 System Tests</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Porting Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="UsingROSonWindows.html">Consuming a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="PortingANode.html">Porting a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="UsingVCPKG.html">Using a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AddingVCPKG.html">Porting a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Porting/Cookbook.html">Porting Cookbook</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">ROS at Microsoft</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/AzureVM.html">Azure VM with ROS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/WinML.html">Windows ML ROS Node</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/azure_kinect_ros_driver">Azure Kinect ROS Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/ros_azure_iothub">Azure IoT Hub Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/vscode">Visual Studio Code ROS Extension ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Advanced</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/source.html">Source Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Advanced/Performance.html">Optimizing Performance</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/msix_ros">ROS on MSIX Packaging ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/rosonwindows/issues">Create Issue</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/support">Paid Support</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ROS on Windows</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Using Github Actions &raquo;</li>
        
      
    
    <li>Continuous Delivery</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ms-iot/rosonwindows/edit/master/docs/GettingStarted/GithubSetupCD.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="continuous-delivery">Continuous Delivery</h1>
<p>Once your ROS package is built, it needs to be deployed to customers. ROS on Windows leverages the Chocolatey Package manager for Delivery.</p>
<p>Chocolatey is an Open Source package manager for Windows, with a command line interface. Chocolatey packages are zip files which contain a descriptor - based on the Nuget Library manager. Once created, Packages are published to the Chocolatey package registry. </p>
<h2 id="sign-up-to-publish-packages">Sign up to Publish packages</h2>
<p>Before you can publish packages, you need to acquire an API key from Chocolatey.
To acquire an API key, you need to <a href="https://chocolatey.org/account/Register">register for an account</a>. Once you've registered for an account, you'll be assigned an API key, which you can assign to your local chocolatey install - and later as a Pipeline Secret.</p>
<p>You can associate the API Key with your chocolatey command line tool to publish with the following command line:</p>
<pre><code>choco apikey --key xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxxxxx --source https://push.chocolatey.org/
</code></pre>

<h2 id="packaging-collateral">Packaging collateral</h2>
<p>To build a chocolatey package, the following files and structure is recommended in your repository. The files will be described later.</p>
<ul>
<li>Repository Root<ul>
<li><code>package</code><ul>
<li><code>MyPackage.nuspec</code></li>
<li><code>build.bat</code></li>
<li><code>chocolateyInstall_template.ps1</code></li>
<li><code>tools</code><ul>
<li><code>rosdepInstall.bat</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="crafting-a-mypackagenuspec-file">Crafting a <code>MyPackage.nuspec</code> file</h2>
<p>A Chocolatey package includes a xml descriptor of the package. Create a file in the <code>package</code> folder named after your ROS package, with the code contents of <a href="choco_template.html">template.nuspec</a>.</p>
<p>For example, if your ROS package is called MyCoolRobot, the file should be called <code>MyCoolRobot.nuspec</code></p>
<p>Modify the properties of the XML file based on your specific requirements. For example:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;package xmlns=&quot;http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&quot;&gt;
  &lt;metadata&gt;
    &lt;id&gt;MyCoolRobot&lt;/id&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;title&gt;MyCoolRobot ROS package&lt;/title&gt;
    &lt;authors&gt;Malcom Reynolds&lt;/authors&gt;
    &lt;licenseUrl&gt;http://www.github.com/ContosoRobotics/MyCoolRobot/License.txt&lt;/licenseUrl&gt;
    &lt;projectUrl&gt;http://www.github.com/ContosoRobotics/MyCoolRobot&lt;/projectUrl&gt;
    &lt;requireLicenseAcceptance&gt;false&lt;/requireLicenseAcceptance&gt;
    &lt;description&gt;MyCoolRobot for ROS on Windows.&lt;/description&gt;
    &lt;summary&gt;MyCoolRobot packaged as a rosdep.&lt;/summary&gt;
    &lt;tags&gt;ros MyCoolRobot&lt;/tags&gt;
    &lt;packageSourceUrl&gt;http://www.github.com/ContosoRobotics/MyCoolRobot&lt;/packageSourceUrl&gt;
    &lt;docsUrl&gt;http://www.github.com/ContosoRobotics/MyCoolRobot/Docs&lt;/docsUrl&gt;
  &lt;/metadata&gt;
&lt;/package&gt;
</code></pre>

<h2 id="adding-install-scripts">Adding install scripts</h2>
<p>Create these files in the tools folder, and add the code contents of each. You can use these directly, or customize them for your project. Examples of customization include custom dependencies (like fetching and installing external Msi files).</p>
<ul>
<li><a href="chocolateyInstall_template.html">chocolateyInstall_template.ps1</a></li>
<li>tools<ul>
<li><a href="rosdepInstall.html">rosdepInstall.bat</a></li>
</ul>
</li>
</ul>
<h2 id="adding-the-build-script">Adding the build script</h2>
<p>In the root of the package folder, add a file with the code contents of <a href="choco_build.html">build.bat</a>. Replace <code>&lt;ros package&gt;</code> with the name of your nuspec from above.</p>
<h2 id="testing-the-package">Testing the package</h2>
<p>In later states, the pipelines will generate a zip file containing the output of your ROS package. </p>
<p>To simulate archive generation for testing, in your terminal window, change directory into the workspace containing your package, then build with install target.</p>
<p>Install 7zip using Chocolatey (You only need to do this the first time you try to build a package).</p>
<pre><code class="batch">choco install 7zip
</code></pre>

<p><strong>Catkin</strong></p>
<pre><code class="batch">catkin_make install -DCATKIN_BUILD_BINARY_PACKAGE=ON
</code></pre>

<p><strong>Colcon</strong></p>
<p><em>Coming Soon</em></p>
<h3 id="package">Package</h3>
<pre><code class="batch">cd install
7z a -tzip ..\src\&lt;ros package&gt;\package\tools\drop.zip *
cd ..\src\&lt;ros package&gt;\package
build.bat
</code></pre>

<p>If this command succeeds, you will have two nupkg files - one for pre-release in <code>output-pre</code>, and one release package in <code>output</code>.</p>
<p>Install using the following command:</p>
<pre><code class="batch">choco install output-pre\&lt;ros package&gt;.1.0.0.nupkg
</code></pre>

<p><strong>Troubleshoot</strong>
If the package fails to install correctly, the nupkg is a zip file. You can expand the zip file and examine the contents. Verify that names are spelled correctly and that the contents match. Once you find the error, you can recreate the package using build.bat, and reinstall using:</p>
<pre><code class="batch">choco install output-pre\&lt;ros package&gt;.1.0.0.nupkg --force
</code></pre>

<blockquote>
<p>NOTE: Chocolatey will remove the root folder of a zip based chocolatey package - which potentially includes other zip based packages. We recommend not uninstalling a chocolatey package for this reason.</p>
</blockquote>
<h2 id="manually-publish-a-chocolatey-package">Manually Publish a chocolatey package</h2>
<pre><code>choco push MyPackage.1.0.0.nupkg --source https://push.chocolatey.org/
</code></pre>

<h1 id="automatically-generate-chocolatey-package-during-ci">Automatically generate chocolatey package during CI</h1>
<p>Once you've crafted your nuspec and tested the installation, you can generate the chocolatey package during CI and publish it as a release. </p>
<p>Now create the Github Action</p>
<ul>
<li>On github, select the <code>Action</code> tab.</li>
<li>Create a new workflow</li>
<li>In the new workflow, copy the contents of <a href="ros1_workflow_pub.html">CD.yaml</a> to the newly created workflow file.</li>
<li>Replace <code>&lt;ros package&gt;</code> with the ROS package you are generating</li>
<li>Replace <code>&lt;ros nuspec&gt;</code> with the name of the nuspec you from above</li>
<li>Replace <code>&lt;ros version&gt;</code> with the version from your nuspec.</li>
</ul>
<p>Whenever you create a tag in the repo, it will trigger the deployment workflow, which will publish the nupkg as a github release.  </p>
<h3 id="updating-chocolatey-rosdep-mappings">Updating Chocolatey rosdep mappings</h3>
<p>Once your chocolatey package has been published, <code>rosdep</code> needs to be informed of how to find it. <code>rosdep</code> enumerates entries in <code>package.xml</code>, then uses a yaml mapping file to locate the package. </p>
<p>To update that mapping file, please follow these steps:</p>
<ul>
<li>Fork <a href="https://github.com/ms-iot/rosdistro-db">https://github.com/ms-iot/rosdistro-db</a> &nearr; into your github account</li>
<li>Create a file called <code>0-update.list</code> in <code>c:\opt\ros\melodic\x64\etc\ros\rosdep\sources.list.d</code></li>
<li>In this file, add a line which points to your fork:</li>
</ul>
<pre><code class="no-highlight"># os-specific listings first
yaml https://raw.githubusercontent.com/&lt;your github&gt;/rosdistro-db/init_windows/rosdep/win-chocolatey.yaml windows
yaml https://raw.githubusercontent.com/&lt;your github&gt;/rosdistro-db/init_windows/rosdep/vcpkg.yaml windows
</code></pre>

<ul>
<li>Add a mapping from the dependency name used in the ROS package</li>
</ul>
<p><code>Python</code></p>
<pre><code class="no-highlight">&lt;python-package-name&gt;:
    windows:
      pip:
        packages: [&lt;python-package-name-in-pip&gt;]
</code></pre>

<p><code>C++</code></p>
<pre><code class="no-highlight">  &lt;package-name&gt;:
    windows:
      chocolatey:
        depends: [&lt;chocolatey dependencies which aren't specified in the package.xml&gt;]
        packages: [&lt;chocolatey-name&gt;]
</code></pre>

<ul>
<li>Update rosdeps on your computer.</li>
</ul>
<pre><code class="no-highlight">rosdep update
rosdep install --from-paths src --ignore-src -r -y
</code></pre>

<blockquote>
<p>You may encounder a warning about missing packages. On Windows some packages were collapsed into their metapackage hosting package due to differences in dependency behavior on Windows.</p>
</blockquote>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="GithubSetupCS_Windows.html" class="btn btn-neutral float-right" title="Continuous Simulation (Windows)">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="GithubSetupCI.html" class="btn btn-neutral" title="Continuous Integration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ms-iot/rosonwindows/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="GithubSetupCI.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="GithubSetupCS_Windows.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
