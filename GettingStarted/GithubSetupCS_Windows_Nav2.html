<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Continuous Simulation for Navigation2 System Tests - ROS on Windows</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous Simulation for Navigation2 System Tests";
    var mkdocs_page_input_path = "GettingStarted\\GithubSetupCS_Windows_Nav2.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ROS on Windows</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../WhatsNew.html">What's New</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/buildfarm.html">Build Status</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Setup.html">ROS 1</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="SetupRos2.html">ROS 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="NewToROS.html">For new ROS Users</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 1</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="http://wiki.ros.org/ROS/Tutorials">Tutorials at ROS Wiki ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/moveit_tutorials.html">MoveIt</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/UR3.html">Universal Robot UR3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Turtlebot/Turtlebot3.html">TurtleBot 3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/sick_s300/getting_started.html">SICK S300</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/ethercat/soem.html">Simple Open EtherCAT Master</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/peak/peak.html">PEAK-System&reg; PCAN&reg;-Basic</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 2</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/nav2.html">Navigation 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Github Actions</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCD.html">Continuous Delivery</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Linux.html">Continuous Simulation (Linux)</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="GithubSetupCS_Windows_Nav2.html">Continuous Simulation for Navigation2 System Tests</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Azure Pipelines</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCD.html">Continuous Delivery</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCS_Linux.html">Continuous Simulation (Linux)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/system_tests.html">Continuous Simulation for Navigation2 System Tests</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Porting Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="UsingROSonWindows.html">Consuming a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="PortingANode.html">Porting a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="UsingVCPKG.html">Using a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AddingVCPKG.html">Porting a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Porting/Cookbook.html">Porting Cookbook</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">ROS at Microsoft</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/AzureVM.html">Azure VM with ROS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/WinML.html">Windows ML ROS Node</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/azure_kinect_ros_driver">Azure Kinect ROS Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/ros_azure_iothub">Azure IoT Hub Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/vscode">Visual Studio Code ROS Extension ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Advanced</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/source.html">Source Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Advanced/Performance.html">Optimizing Performance</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/msix_ros">ROS on MSIX Packaging ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/rosonwindows/issues">Create Issue</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/support">Paid Support</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ROS on Windows</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Using Github Actions &raquo;</li>
        
      
    
    <li>Continuous Simulation for Navigation2 System Tests</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ms-iot/rosonwindows/edit/master/docs/GettingStarted/GithubSetupCS_Windows_Nav2.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="overview">Overview</h2>
<p>After defining your robot behavior, it is important to ensure the robot running as expected as the project iterates.
The traditional unit tests and integration tests usually use the static data to exercise your code.
Continous simulation demonstrates how you make use of <code>GitHub Actions</code> and <a href="https://azure.microsoft.com/en-us/resources/templates/ros-vm-windows/"><code>ROS on Azure with Windows VM</code></a> to run your code in Hardware-in-the-loop simulation and virtual environments.
In this lab, we begin with self-driving car project with Gazebo simulation, test it on the rostest framework, and then cloud-host the continuous simulation on GitHub Actions.</p>
<p>This tutorial is to show how to use <code>GitHub Actions</code> to exercise the <a href="https://github.com/ros-planning/navigation2/tree/main/nav2_system_tests">Navigation2 System Tests</a>.
It is a comprehensive End-to-End test pass with Gazebo simulation.
This project is a good example for ROS 2 developers how to organize a End-to-End tests across multiple packages and tools.</p>
<h2 id="objectives">Objectives</h2>
<ul>
<li>
<p>Run and observe the Nav2 system tests running locally.</p>
</li>
<li>
<p>Deploy and register a ROS on Windows GPU optimized virtual machine on Azure.</p>
</li>
<li>
<p>Integrate a GitHub project with GitHub Actions.</p>
</li>
<li>
<p>Observe the simulation runs and test results on the pipeline.</p>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>An Microsoft Azure account from https://portal.azure.com.</p>
</li>
<li>
<p>A GitHub account from https://github.com.</p>
</li>
</ul>
<h2 id="exercise-1-build-and-run-nav2-system-tests-locally">Exercise 1: Build And Run Nav2 System Tests Locally</h2>
<ol>
<li>
<p><a href="SetupRos2.html"><code>Install ROS2</code></a>. <code>Foxy</code> is recommended.</p>
</li>
<li>
<p>Open the ROS 2 command prompt and activate the Gazebo environment.</p>
</li>
</ol>
<pre><code class="Batchfile">c:\opt\ros\foxy\x64\setup.bat
c:\opt\ros\foxy\x64\share\gazebo\setup.bat
set SDF_PATH=c:\opt\ros\foxy\x64\share\sdformat\1.6
</code></pre>

<ol>
<li>Create an empty workspace and clone the Navigation2 repositories. For example,</li>
</ol>
<pre><code class="Batchfile">:: create an empty workspace
mkdir c:\nav2_ws\src
cd c:\nav2_ws

:: clone the Navigation2
curl https://raw.githubusercontent.com/ms-iot/ROSOnWindows/master/docs/ros2/navigation2_foxy.repos -o navigation2_foxy.repos
vcs import src &lt; navigation2_foxy.repos
</code></pre>

<ol>
<li>Build the Navigation2 System Tests projects.</li>
</ol>
<pre><code class="Batchfile">:: then, build the nav2_system_tests
colcon build --packages-select nav2_system_tests
</code></pre>

<p>A few moment later, a similar message should be put to indicate a successful build:</p>
<pre><code>Summary: 1 package finished [2min 10s]
</code></pre>

<blockquote>
<p>In cases of any build failures, <code>Log</code> folder can be found under the workspace. Detailed information can be found there.</p>
</blockquote>
<ol>
<li>Run the Nav2 System Tests</li>
</ol>
<pre><code class="Batchfile">colcon test --packages-select nav2_system_tests
</code></pre>

<ol>
<li>Verify the test result.</li>
</ol>
<pre><code class="Batchfile">colcon test-result
</code></pre>

<h2 id="exercise-2-provision-cloud-ci-environment-with-github-actions">Exercise 2: Provision Cloud CI Environment With GitHub Actions</h2>
<h3 id="task-1-create-a-github-repository">Task 1: Create a GitHub Repository</h3>
<ol>
<li><a href="https://docs.github.com/en/github/getting-started-with-github/create-a-repo">Create a repository</a> under your account.</li>
<li>Go to your repository and navigate to the <code>Actions</code> tab.</li>
<li>Make sure it is enabled by your permission.
   <img alt="github-actions" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/github-actions.png" /></li>
</ol>
<h3 id="task-2-prepare-permission-for-self-hosted-github-runner">Task 2: Prepare Permission For Self-Hosted GitHub Runner</h3>
<ol>
<li>Create a GitHub <a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">personal access token</a> and select the scope of <code>repo</code>.</li>
<li>Take a note of the personal access token (PAT).</li>
</ol>
<h3 id="task-3-deploy-virtual-machine-and-register-as-self-hosted-github-runner">Task 3: Deploy Virtual Machine and Register as Self-Hosted GitHub Runner</h3>
<p>This <a href="https://azure.microsoft.com/en-us/resources/templates/ros-vm-windows/"><code>ROS on Azure with Windows VM</code></a> is a Azure quickstart template to help setup an Azure virtual machine with ROS installed.</p>
<ol>
<li>Navigate to the template. Click <code>Deploy to Azure</code>.</li>
<li>A form will be brought to you and here are some important parameters for this exercise.</li>
<li><strong>Virtual Machine Size</strong>: Select <code>Standard_NV*</code> for GPU optimized virtual machine. This is required for Gazebo.</li>
<li><strong>Vm Image</strong>: Select <code>Visual Studio 2019</code> for the required toolchain to build project.</li>
<li><strong>Pipeline Provider</strong>: Select <code>GitHubRunner</code> to register as GitHub Self-hosted Runner.</li>
<li><strong>GitHub Repo</strong>: This is your GitHub account and the repository name seperated by a forward slash. For example, <code>&lt;your GitHub account&gt;/ros_simulation_lab</code> is the value of this fork.</li>
<li><strong>GitHub Personal Access Token</strong>: This is the PAT noted from the previous section.</li>
</ol>
<h3 id="task-4-create-the-github-workflow-files">Task 4: Create the GitHub Workflow Files</h3>
<p>The GitHub workflow is a YAML file to define what the steps to take by the GitHub runner.
In this example, you will define one to checkout the code, build it and run tests.</p>
<ol>
<li>Create a file <code>.github/workflows/build-windows.yml</code> under your repository.</li>
</ol>
<pre><code class="yaml">name: Build and Test on Windows
on: [push]

jobs:
  build_and_test:
    runs-on: [self-hosted, windows]
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: recursive
    - name: Prepare
      run: |
        $env:ChocolateyInstall=&quot;c:\opt\chocolatey&quot;
        Set-ExecutionPolicy Bypass -Scope Process -Force;
        iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
        choco sources add -n=roswin -s https://aka.ms/ros/public --priority 1
        choco install ros-foxy-desktop -y --pre --no-progress -i
      shell: powershell
    - name: Build
      run: |
        call &quot;C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\Common7\Tools\VsDevCmd.bat&quot; -arch=amd64 -host_arch=amd64
        call &quot;c:\opt\ros\foxy\x64\setup.bat&quot;
        call &quot;c:\opt\ros\foxy\x64\share\gazebo\setup.bat&quot;
        set &quot;SDF_PATH=c:\opt\ros\foxy\x64\share\sdformat\1.6&quot;
        mkdir ws\src
        cd ws
        curl https://raw.githubusercontent.com/ms-iot/ROSOnWindows/master/docs/ros2/navigation2_foxy.repos -o navigation2_foxy.repos
        vcs import src &lt; navigation2_foxy.repos
        colcon build --packages-select nav2_system_tests
        colcon test --packages-select nav2_system_tests --event-handlers console_direct+
        colcon test-result
      shell: cmd
    - name: Archive test results # workaround: https://github.com/actions/upload-artifact/issues/76
      run: zip -r results.zip build
      working-directory: ws
    - name: Upload test results
      uses: actions/upload-artifact@v2
      with:
        path: ws/results.zip
</code></pre>

<ol>
<li>Commit and push the workflow files to your remote repository.</li>
</ol>
<h3 id="task-4-observe-the-github-actions">Task 4: Observe the GitHub Actions</h3>
<p>Now a workflow should be scheduled to run under your repository.</p>
<ol>
<li>
<p>Navigate to the <code>Actions</code> tab and make sure workflows are listed there.
   <img alt="github-actions-summary" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/github-actions-summary.png" /></p>
</li>
<li>
<p>Observe the runs of the workflows.
   And you can explore more on <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#about-workflows">GitHub Help</a>.</p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="AzureSetupCI.html" class="btn btn-neutral float-right" title="Continuous Integration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="GithubSetupCS_Linux.html" class="btn btn-neutral" title="Continuous Simulation (Linux)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ms-iot/rosonwindows/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="GithubSetupCS_Linux.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="AzureSetupCI.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
