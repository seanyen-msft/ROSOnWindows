<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Continuous Simulation (Linux) - ROS on Windows</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous Simulation (Linux)";
    var mkdocs_page_input_path = "GettingStarted\\AzureSetupCS_Linux.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ROS on Windows</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../WhatsNew.html">What's New</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/buildfarm.html">Build Status</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Get ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Setup.html">ROS 1</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="SetupRos2.html">ROS 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using ROS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="NewToROS.html">For new ROS Users</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 1</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="http://wiki.ros.org/ROS/Tutorials">Tutorials at ROS Wiki ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/moveit_tutorials.html">MoveIt</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Moveit/UR3.html">Universal Robot UR3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Turtlebot/Turtlebot3.html">TurtleBot 3</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/sick_s300/getting_started.html">SICK S300</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/ethercat/soem.html">Simple Open EtherCAT Master</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorials/peak/peak.html">PEAK-System&reg; PCAN&reg;-Basic</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started with ROS 2</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/nav2.html">Navigation 2</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Github Actions</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCD.html">Continuous Delivery</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Linux.html">Continuous Simulation (Linux)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="GithubSetupCS_Windows_Nav2.html">Continuous Simulation for Navigation2 System Tests</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Using Azure Pipelines</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCI.html">Continuous Integration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCD.html">Continuous Delivery</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AzureSetupCS_Windows.html">Continuous Simulation (Windows)</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="AzureSetupCS_Linux.html">Continuous Simulation (Linux)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#objectives">Objectives</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-1-build-and-run-autonomous-car-simulation-locally">Exercise 1: Build And Run Autonomous Car Simulation Locally</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-2-run-rostest-with-autonomous-car-simulation-locally">Exercise 2: Run ROSTest With Autonomous Car Simulation Locally</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercise-3-provision-cloud-ci-environment-with-azure-pipelines">Exercise 3: Provision Cloud CI Environment With Azure Pipelines</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#task-1-prepare-permission-for-azure-devops-agent-pool">Task 1: Prepare Permission For Azure DevOps Agent Pool</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#task-2-deploy-virtual-machine-and-register-as-azure-devops-build-agent">Task 2: Deploy Virtual Machine and Register as Azure DevOps Build Agent</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#task-3-integrate-your-github-projects-with-azure-pipelines">Task 3: Integrate Your GitHub Projects With Azure Pipelines</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#task-4-observe-the-build-summary-and-test-results">Task 4: Observe the Build Summary and Test Results</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ros2/system_tests.html">Continuous Simulation for Navigation2 System Tests</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Porting Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="UsingROSonWindows.html">Consuming a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="PortingANode.html">Porting a ROS Package</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="UsingVCPKG.html">Using a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="AddingVCPKG.html">Porting a C++ Dependency</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Porting/Cookbook.html">Porting Cookbook</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">ROS at Microsoft</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/AzureVM.html">Azure VM with ROS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../ROSAtMS/WinML.html">Windows ML ROS Node</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/azure_kinect_ros_driver">Azure Kinect ROS Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/microsoft/ros_azure_iothub">Azure IoT Hub Node ðŸ”—</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/vscode">Visual Studio Code ROS Extension ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Advanced</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Build/source.html">Source Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Advanced/Performance.html">Optimizing Performance</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/msix_ros">ROS on MSIX Packaging ðŸ”—</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/ms-iot/rosonwindows/issues">Create Issue</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://aka.ms/ros/support">Paid Support</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ROS on Windows</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Using Azure Pipelines &raquo;</li>
        
      
    
    <li>Continuous Simulation (Linux)</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ms-iot/rosonwindows/edit/master/docs/GettingStarted/AzureSetupCS_Linux.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="continuous-simulation-lab-with-azure-pipelines-linux">Continuous Simulation Lab with Azure Pipelines (Linux)</h1>
<h2 id="overview">Overview</h2>
<p>After defining your robot behavior, it is important to ensure the robot running as expected as the project iterates.
The traditional unit tests and integration tests usually use the static data to exercise your code.
Continous simulation demonstrates how you make use of <code>Azure Pipelines</code> and <a href="https://azure.microsoft.com/en-us/resources/templates/ros-vm-linux/"><code>ROS on Azure with Linux VM</code></a> to run your code in Hardware-in-the-loop simulation and virtual environments.
In this lab, we begin with self-driving car project with Gazebo simulation, test it on the rostest framework, and then cloud-host the continuous simulation on Azure Pipelines.</p>
<p>This lab uses the <a href="https://github.com/Autonomous-Racing-PG/ar-tu-do">software</a> developed by the Autonomous Racing Project Group of <a href="https://ls12-www.cs.tu-dortmund.de/daes/">TU Dortmund</a>.
Credit goes to all the <a href="https://github.com/Autonomous-Racing-PG/ar-tu-do/graphs/contributors">contributors</a>.</p>
<h2 id="objectives">Objectives</h2>
<ul>
<li>
<p>Run and observe the autonomous racecar simulation locally.</p>
</li>
<li>
<p>Deploy and register a ROS on Linux virtual machine on Azure.</p>
</li>
<li>
<p>Integrate a GitHub project with Azure Pipelines.</p>
</li>
<li>
<p>Observe the simulation runs and test results on the pipeline.</p>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>An Microsoft Azure account from https://portal.azure.com.</p>
</li>
<li>
<p>An Azure DevOps account from https://dev.azure.com.</p>
</li>
<li>
<p>A GitHub account from https://github.com.</p>
</li>
</ul>
<h2 id="exercise-1-build-and-run-autonomous-car-simulation-locally">Exercise 1: Build And Run Autonomous Car Simulation Locally</h2>
<ol>
<li>Fork <a href="https://github.com/ms-iot/ros_simulation_lab"><code>ms-iot/ros_simulation_lab</code></a> repository into your GitHub account.</li>
<li>Follow this ROS Wiki <a href="http://wiki.ros.org/Installation/Ubuntu">page</a> to install ROS Melodic on Ubuntu.</li>
<li>Open a new shell. The below example assumes using <code>bash</code>.</li>
</ol>
<pre><code class="bash"># Clone the github project
git clone https://github.com/&lt;your account&gt;/ros_simulation_lab --recursive
cd ros_simulation_lab

# install required components
sudo apt update
rosdep update
rosdep install --from-paths catkin_ws/src --ignore-src -r -y
pip install circle-fit

# build it
cd catkin_ws
catkin_make
</code></pre>

<ol>
<li>Run the autonomous car simulation.</li>
</ol>
<pre><code class="bash"># source the ROS devel space.
source ./devel/setup.bat

# run the application
roslaunch src/ar-tu-do/ros_ws/launch/gazebo.launch world:=racetrack mode_override:=2
</code></pre>

<p>This launch file runs a racecar in a simulated track in Gazebo and runs autonomous driving.</p>
<p><img alt="simulation" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/simulation.png" /></p>
<h2 id="exercise-2-run-rostest-with-autonomous-car-simulation-locally">Exercise 2: Run ROSTest With Autonomous Car Simulation Locally</h2>
<ol>
<li>End the previous exercise and run the following rostest file:</li>
</ol>
<pre><code class="bash"># source the ROS devel space.
source ./devel/setup.bat

# run the rostest
rostest demo demo.test
</code></pre>

<p>This <a href="https://github.com/ms-iot/ros_simulation_lab/catkin_ws/src/demo/test/demo.test"><code>demo.test</code></a> runs the same task as the previous exercise but in headless mode.
Additonally, it runs a <a href="https://github.com/ms-iot/ros_simulation_lab/catkin_ws/src/demo/nodes/demo.py"><code>demo.py</code></a> node to kick off a validation on the latest lap time.
The <a href="https://github.com/ms-iot/ros_simulation_lab/catkin_ws/src/demo"><code>demo</code></a> package demonstrates an example how to organize your robot simulation with the rostest framework.
Now let's move this exercise to cloud-hosted environment with Azure Pipelines.</p>
<h2 id="exercise-3-provision-cloud-ci-environment-with-azure-pipelines">Exercise 3: Provision Cloud CI Environment With Azure Pipelines</h2>
<h3 id="task-1-prepare-permission-for-azure-devops-agent-pool">Task 1: Prepare Permission For Azure DevOps Agent Pool</h3>
<ol>
<li>This <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-windows?view=azure-devops#permissions">module</a> guides you how to prepare permission for the agent pool.</li>
<li>Take a note of the personal access token (PAT).</li>
</ol>
<h3 id="task-2-deploy-virtual-machine-and-register-as-azure-devops-build-agent">Task 2: Deploy Virtual Machine and Register as Azure DevOps Build Agent</h3>
<p>This <a href="https://azure.microsoft.com/en-us/resources/templates/ros-vm-linux/"><code>ROS on Azure with Linux VM</code></a> is a Azure quickstart template to help setup an Azure virtual machine with ROS installed.</p>
<ol>
<li>Navigate to the template. Click <code>Deploy to Azure</code>.</li>
<li>A form will be brought to you and here are some important parameters for this exercise.</li>
<li><strong>Pipeline Provider</strong>: Select <code>AzurePipelines</code> to use Azure DevOps.</li>
<li><strong>Vsts Account</strong>: This is your Azure DevOps organization name. For example, this is the <code>name</code> of <code>https://dev.azure.com/&lt;name&gt;</code>.</li>
<li><strong>Vsts Personal Access Token</strong>: This is the PAT noted from the previous section.</li>
<li><strong>Vsts Pool Name</strong>: Leave it to <code>Default</code> to match the pool name in this exercise.</li>
</ol>
<p><img alt="template" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/template-linux.png" /></p>
<h3 id="task-3-integrate-your-github-projects-with-azure-pipelines">Task 3: Integrate Your GitHub Projects With Azure Pipelines</h3>
<ol>
<li>Fork <a href="https://github.com/ms-iot/ros_simulation_lab"><code>ms-iot/ros_simulation_lab</code></a> repository into your GitHub account.</li>
<li>The <a href="https://www.azuredevopslabs.com/labs/azuredevops/github-integration/"><code>Integrate Your GitHub Projects With Azure Pipelines</code></a> guides you how to create a pipeline for a GitHub project in Task 1 &amp; 2.
   Use your fork as the target repository.</li>
<li>Navigate to the "Existing Azure Pipelines YAML file" and select <code>azure-pipelines-linux.yml</code>.</li>
<li>Now you should have a pipeline running (or ready to run).</li>
</ol>
<h3 id="task-4-observe-the-build-summary-and-test-results">Task 4: Observe the Build Summary and Test Results</h3>
<ol>
<li>
<p>Click on a finished build and you will see a summary like:
   <img alt="summary" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/summary.png" /></p>
</li>
<li>
<p>Check the <code>Related</code> and there is one artifact published, where you can find details logs for this run.
   In this example, you can also find the bag files for further analysis.
   <img alt="logs" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/logs.png" /></p>
</li>
<li>
<p>Check the <code>Test and coverage</code> and you can find details test results by following the pass rate hyperlink.
   <img alt="test_results" src="https://github.com/ms-iot/ros_simulation_lab/raw/master/docs/test_results.png" /></p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ros2/system_tests.html" class="btn btn-neutral float-right" title="Continuous Simulation for Navigation2 System Tests">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="AzureSetupCS_Windows.html" class="btn btn-neutral" title="Continuous Simulation (Windows)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ms-iot/rosonwindows/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="AzureSetupCS_Windows.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ros2/system_tests.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
